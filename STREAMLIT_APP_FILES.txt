â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
STREAMLIT APPLICATION - Táº¤T Cáº¢ CÃC FILE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Generated: $(date)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
Tá»”NG QUAN
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

á»¨ng dá»¥ng Streamlit lÃ  giao diá»‡n ngÆ°á»i dÃ¹ng chÃ­nh cho Data Lakehouse, bao gá»“m:

âœ… TÃNH NÄ‚NG CHÃNH:

1. ğŸ  Main Dashboard - Trang chá»§ vá»›i navigation
2. ğŸ“Š Query Window - Cá»­a sá»• truy váº¥n Ä‘a chiá»u (OLAP Analysis)
3. ğŸ’¬ Chat - Giao diá»‡n chat vá»›i SQL + RAG capabilities

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ KIáº¾N TRÃšC:

User Browser
    â†“
Streamlit (Port 8501)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Main Page     â”‚  Query Window    â”‚   Chat Service   â”‚
â”‚   (app.py)      â”‚  (Trino Direct)  â”‚   (REST API)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“                 â†“                    â†“
    Navigation         Trino:8080         chat_service:8001
                           â†“                    â†“
                      Delta Lake           SQL + RAG
                      (MinIO S3)          (Qdrant + LLM)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ TECHNOLOGY STACK:

- Streamlit 1.x - Web framework
- Python 3.9 - Runtime
- Trino connector - Direct database queries
- Pandas - Data manipulation
- Docker - Containerization

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš€ CÃCH Sá»¬ Dá»¤NG:

1. Access: http://localhost:8501
2. Navigate qua sidebar
3. Chá»n tÃ­nh nÄƒng:
   - Query Window: PhÃ¢n tÃ­ch OLAP
   - Chat: Há»i Ä‘Ã¡p báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FILE: app/app.py
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

import streamlit as st

# Set page config
st.set_page_config(
    page_title="Data Lakehouse Dashboard",
    page_icon="ğŸ ",
    layout="wide"
)

# Title
st.title("ğŸ  á»¨NG Dá»¤NG MODERN DATA STACK XÃ‚Y Dá»°NG LAKEHOUSE CHO BRAZILIAN E-COMMERCE (OLIST)")

# Description
st.markdown("""
### ğŸ‘‹ ChÃ o má»«ng Ä‘áº¿n vá»›i Data Lakehouse!

Há»‡ thá»‘ng Modern Data Stack vá»›i kiáº¿n trÃºc Medallion Architecture (Bronze â†’ Silver â†’ Gold â†’ Platinum).

**ğŸ“Š CÃ¡c tÃ­nh nÄƒng:**
- **Query Window**: Truy váº¥n Ä‘a chiá»u trá»±c tiáº¿p trÃªn Trino
- **Dagster**: Orchestration vÃ  scheduling ETL pipelines
- **Metabase**: Business Intelligence vÃ  dashboards
- **MinIO**: Object storage cho Data Lake
""")

st.divider()

# Create columns for service cards
col1, col2 = st.columns(2)

with col1:
    st.subheader("ğŸ“Š PhÃ¢n tÃ­ch dá»¯ liá»‡u")
    
    # Query Window
    st.info("**ğŸ§® Query Window**  \nTruy váº¥n Ä‘a chiá»u vá»›i Trino")
    st.page_link("pages/1_ğŸ“Š_Query_Window.py", label="Má»Ÿ Query Window", icon="ğŸ“Š")
    
    st.markdown("---")
    
    # Metabase
    st.info("**ğŸ“ˆ Metabase**  \nDashboards vÃ  BI")
    if st.button("Má»Ÿ Metabase", key="metabase", use_container_width=True):
        st.markdown("[ğŸ”— http://localhost:3000](http://localhost:3000)")

with col2:
    st.subheader("ğŸ”§ Quáº£n lÃ½ há»‡ thá»‘ng")
    
    # Dagster
    st.info("**âš™ï¸ Dagster**  \nOrchestration & ETL")
    if st.button("Má»Ÿ Dagster", key="dagster", use_container_width=True):
        st.markdown("[ğŸ”— http://localhost:3001](http://localhost:3001)")
    
    st.markdown("---")
    
    # MinIO
    st.info("**ğŸª£ MinIO Console**  \nObject Storage")
    if st.button("Má»Ÿ MinIO", key="minio", use_container_width=True):
        st.markdown("[ğŸ”— http://localhost:9001](http://localhost:9001)")

st.divider()

# System status
st.subheader("ğŸ” Tráº¡ng thÃ¡i há»‡ thá»‘ng")

col_stat1, col_stat2, col_stat3, col_stat4 = st.columns(4)

with col_stat1:
    st.metric("Trino", "âœ… Running", "Port 8082 (ext)")

with col_stat2:
    st.metric("Dagster", "âœ… Running", "Port 3001")

with col_stat3:
    st.metric("Metabase", "âœ… Running", "Port 3000")

with col_stat4:
    st.metric("MinIO", "âœ… Running", "Port 9001")

# Footer
st.divider()
st.caption("ğŸ’¡ Tip: Sá»­ dá»¥ng sidebar Ä‘á»ƒ Ä‘iá»u hÆ°á»›ng giá»¯a cÃ¡c trang")

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FILE: app/pages/1_ğŸ“Š_Query_Window.py
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

import os
import streamlit as st
import pandas as pd
from datetime import date, datetime, timedelta
from trino.dbapi import connect
from trino.auth import BasicAuthentication

# ====== Config ======
def get_conf(key, default=None):
    # Æ°u tiÃªn secrets.toml, sau Ä‘Ã³ env
    try:
        return st.secrets.get(key, os.getenv(key, default))
    except:
        return os.getenv(key, default)

TRINO_HOST = get_conf("TRINO_HOST", "trino")
TRINO_PORT = int(get_conf("TRINO_PORT", "8080"))
TRINO_CATALOG = get_conf("TRINO_CATALOG", "lakehouse")
TRINO_USER = get_conf("TRINO_USER", "admin")
TRINO_PASSWORD = get_conf("TRINO_PASSWORD", "") or None

DEFAULT_SCHEMA = get_conf("TRINO_DEFAULT_SCHEMA", "gold")

# ====== Helpers ======
@st.cache_data(ttl=600, show_spinner="Äang cháº¡y truy váº¥n...")
def run_query(sql: str, schema: str):
    """Execute SQL query on Trino and return DataFrame"""
    try:
        conn = connect(
            host=TRINO_HOST,
            port=TRINO_PORT,
            user=TRINO_USER,
            catalog=TRINO_CATALOG,
            schema=schema,
            http_scheme="http",
            auth=None if not TRINO_PASSWORD else BasicAuthentication(TRINO_USER, TRINO_PASSWORD),
            source="streamlit-query-window"
        )
        cur = conn.cursor()
        cur.execute(sql)
        rows = cur.fetchall()
        cols = [d[0] for d in cur.description]
        conn.close()
        return pd.DataFrame(rows, columns=cols)
    except Exception as e:
        st.error(f"Lá»—i káº¿t ná»‘i Trino: {e}")
        raise

def build_sql(catalog:str, schema:str, table:str, date_col:str, grain:str,
              dims:list, measures:list, start:date, end:date, extra_filters:str, 
              use_rollup:bool, use_grouping_sets:bool, limit:int=None):
    """Build SQL query with time grain, dimensions, and measures"""
    
    # Time grain expression
    grain_expr = f"date_trunc('{grain}', {date_col})"
    
    # Build SELECT clause
    select_cols = [f"{grain_expr} AS {grain}"]
    
    # Add dimensions to SELECT
    for dim in dims:
        if "." in dim:  # Handle joined columns
            select_cols.append(dim)
        else:
            select_cols.append(dim)
    
    # Add measures
    select_cols.extend(measures)
    
    # Build GROUP BY clause - use full expressions, not aliases
    group_cols = [grain_expr]  # Use full expression instead of alias
    group_cols.extend(dims)  # Add dimension columns
    
    # Build WHERE clause
    where = [f"CAST({date_col} AS date) BETWEEN DATE '{start}' AND DATE '{end}'"]
    if extra_filters.strip():
        banned = [";","--","/*","*/","DROP","TRUNCATE","INSERT","UPDATE","DELETE","CALL","CREATE","ALTER"]
        bad = [w for w in banned if w.lower() in extra_filters.lower()]
        if bad:
            raise ValueError(f"Filter chá»©a tá»« khÃ³a khÃ´ng há»£p lá»‡: {', '.join(set(bad))}")
        where.append(f"({extra_filters})")
    where_sql = " AND ".join(where)
    
    from_ = f"{catalog}.{schema}.{table}"
    
    # Build GROUP BY with ROLLUP or GROUPING SETS
    if use_grouping_sets and dims:
        sets = []
        # Full dims
        sets.append(f"({grain_expr}, {', '.join(dims)})")
        # Drop dims one by one
        for i in range(len(dims)-1, 0, -1):
            sets.append(f"({grain_expr}, {', '.join(dims[:i])})")
        # Only grain
        sets.append(f"({grain_expr})")
        # Grand total
        sets.append("()")
        group_sql = f"GROUP BY GROUPING SETS (\n  {', '.join(sets)}\n)"
    elif use_rollup and dims:
        group_sql = f"GROUP BY ROLLUP ({grain_expr}, {', '.join(dims)})"
    else:
        group_sql = f"GROUP BY {', '.join(group_cols)}"
    
    # Build ORDER BY - use column positions (1-based) for Trino compatibility
    # Äáº©y subtotal/grand total xuá»‘ng sau cÃ¹ng báº±ng cÃ¡ch sort NULLS LAST
    order_positions = [str(i+1) for i in range(1 + len(dims))]  # time grain + dimensions
    order_sql = "ORDER BY " + ", ".join([f"{p} NULLS LAST" for p in order_positions])
    
    # Build LIMIT
    limit_sql = f"LIMIT {limit}" if limit else ""
    
    sql = f"""
SELECT
  {', '.join(select_cols)}
FROM {from_}
WHERE {where_sql}
{group_sql}
{order_sql}
{limit_sql}
    """.strip()
    
    return sql

# ====== TABLE & COLUMN METADATA ======
TABLES_META = {
    "gold": {
        "fact_order": {
            "date_col": "full_date",
            "description": "Fact table: 1 row per order",
            "dimensions": [
                "customer_id",
                "primary_payment_type",
                "is_canceled",
                "delivered_on_time"
            ],
            "measures": [
                "COUNT(*) AS order_count",
                "COUNT(DISTINCT customer_id) AS unique_customers",
                "SUM(items_count) AS total_items",
                "SUM(sum_price) AS total_price",
                "SUM(sum_freight) AS total_freight",
                "SUM(payment_total) AS total_payment",
                "AVG(delivered_days) AS avg_delivery_days",
                "SUM(CASE WHEN delivered_on_time THEN 1 ELSE 0 END) AS on_time_deliveries",
                "SUM(CASE WHEN is_canceled THEN 1 ELSE 0 END) AS canceled_orders"
            ]
        },
        "fact_order_item": {
            "date_col": "full_date",
            "description": "Fact table: 1 row per order item",
            "dimensions": [
                "product_id",
                "seller_id",
                "customer_id",
                "order_status"
            ],
            "measures": [
                "COUNT(*) AS item_count",
                "COUNT(DISTINCT order_id) AS order_count",
                "COUNT(DISTINCT product_id) AS unique_products",
                "COUNT(DISTINCT seller_id) AS unique_sellers",
                "SUM(price) AS total_revenue",
                "SUM(freight_value) AS total_freight",
                "AVG(price) AS avg_item_price"
            ]
        }
    },
    "platinum": {
        "dm_sales_monthly_category": {
            "date_col": "month",
            "description": "Monthly sales by product category",
            "dimensions": [
                "product_category_name",
                "product_category_name_english"
            ],
            "measures": [
                "SUM(total_revenue) AS total_revenue",
                "SUM(total_items) AS total_items",
                "SUM(unique_products) AS unique_products",
                "AVG(avg_price) AS avg_price"
            ]
        }
    }
}

# ====== UI ======
st.title("ğŸ§® Cá»­a sá»• truy váº¥n Ä‘a chiá»u")
st.caption("PhÃ¢n tÃ­ch dá»¯ liá»‡u Brazilian E-commerce vá»›i Trino")

# ====== Schema & Table Selection ======
col_meta1, col_meta2 = st.columns(2)

with col_meta1:
    schemas = list(TABLES_META.keys())
    schema = st.selectbox("ğŸ“ Schema", schemas, index=schemas.index(DEFAULT_SCHEMA))

with col_meta2:
    tables = list(TABLES_META[schema].keys())
    fact_table = st.selectbox("ğŸ“Š Fact Table", tables)

table_meta = TABLES_META[schema][fact_table]
st.info(f"â„¹ï¸ {table_meta['description']}")

# ====== Time Selection ======
st.subheader("â° Thá»i gian")
col_time1, col_time2, col_time3 = st.columns(3)

with col_time1:
    time_grain = st.selectbox("ğŸ” Time Grain", ["day","week","month","quarter","year"], index=2)

with col_time2:
    # Default: last 6 months
    default_start = datetime.now().replace(day=1) - timedelta(days=180)
    start_date = st.date_input("ğŸ“… Tá»« ngÃ y", default_start.date())

with col_time3:
    end_date = st.date_input("ğŸ“… Äáº¿n ngÃ y", date.today())

# ====== Dimensions Selection ======
st.subheader("ğŸ“ Dimensions (Chiá»u phÃ¢n tÃ­ch)")
available_dims = table_meta["dimensions"]
dims = st.multiselect(
    "Chá»n cÃ¡c chiá»u Ä‘á»ƒ phÃ¢n tÃ­ch (tá»‘i Ä‘a 3-4 chiá»u cho hiá»‡u suáº¥t tá»‘t)",
    available_dims,
    default=available_dims[:2] if len(available_dims) >= 2 else available_dims
)

# ====== Measures Selection ======
st.subheader("ğŸ“ Measures (Chá»‰ sá»‘)")
available_measures = table_meta["measures"]
measures = st.multiselect(
    "Chá»n cÃ¡c chá»‰ sá»‘ cáº§n tÃ­nh toÃ¡n",
    available_measures,
    default=available_measures[:3] if len(available_measures) >= 3 else available_measures
)

# ====== Filters ======
st.subheader("ğŸ” Bá»™ lá»c")
extra_filters = st.text_area(
    "WHERE clause bá»• sung (vÃ­ dá»¥: primary_payment_type = 'credit_card' AND delivered_on_time = true)",
    "",
    height=80
)

# ====== Advanced Options ======
with st.expander("âš™ï¸ TÃ¹y chá»n nÃ¢ng cao"):
    col_adv1, col_adv2, col_adv3 = st.columns(3)
    
    with col_adv1:
        use_rollup = st.checkbox("DÃ¹ng ROLLUP (tá»•ng theo má»i cáº¥p)", value=False)
    
    with col_adv2:
        use_gsets = st.checkbox("DÃ¹ng GROUPING SETS", value=False)
    
    with col_adv3:
        limit_rows = st.number_input("Giá»›i háº¡n sá»‘ dÃ²ng", min_value=0, max_value=100000, value=10000, step=1000)

# ====== Run Query ======
if st.button("â–¶ï¸ Cháº¡y truy váº¥n", type="primary", use_container_width=True):
    if not dims:
        st.warning("âš ï¸ Vui lÃ²ng chá»n Ã­t nháº¥t 1 dimension")
        st.stop()
    
    if not measures:
        st.warning("âš ï¸ Vui lÃ²ng chá»n Ã­t nháº¥t 1 measure")
        st.stop()
    
    # Build SQL
    sql = build_sql(
        TRINO_CATALOG, schema, fact_table, table_meta["date_col"], time_grain,
        dims, measures, start_date, end_date, extra_filters,
        use_rollup, use_gsets, limit_rows if limit_rows > 0 else None
    )
    
    # Show SQL
    with st.expander("ğŸ“ SQL Query"):
        st.code(sql, language="sql")
    
    # Execute query
    try:
        with st.spinner("â³ Äang truy váº¥n dá»¯ liá»‡u..."):
            df = run_query(sql, schema)
        
        if df.empty:
            st.warning("ğŸ“­ KhÃ´ng cÃ³ dá»¯ liá»‡u phÃ¹ há»£p vá»›i Ä‘iá»u kiá»‡n")
            st.stop()
        
        # Display results
        st.success(f"âœ… Tráº£ vá» {len(df):,} dÃ²ng")
        st.subheader("ğŸ“Š Káº¿t quáº£")
        
        # Táº¡o báº£n hiá»ƒn thá»‹ riÃªng (giá»¯ df gá»‘c Ä‘á»ƒ export chuáº©n sá»‘)
        df_display = df.copy()
        numeric_cols = df_display.select_dtypes(include=['int64', 'float64']).columns
        for col in numeric_cols:
            df_display[col] = df_display[col].apply(lambda x: f"{x:,.2f}" if pd.notna(x) else "")
        
        st.dataframe(df_display, use_container_width=True, height=500)
        
        # Summary statistics
        with st.expander("ğŸ“ˆ Thá»‘ng kÃª tá»•ng há»£p"):
            st.write("Tá»•ng sá»‘ dÃ²ng:", f"{len(df):,}")
            st.write("CÃ¡c cá»™t:", ", ".join(df.columns))
        
        # Export options
        st.subheader("ğŸ’¾ Xuáº¥t dá»¯ liá»‡u")
        col_exp1, col_exp2 = st.columns(2)
        
        with col_exp1:
            # CSV export
            csv = df.to_csv(index=False).encode("utf-8")
            st.download_button(
                "â¬‡ï¸ Táº£i CSV",
                csv,
                f"query_result_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv",
                "text/csv",
                use_container_width=True
            )
        
        with col_exp2:
            # Excel export
            try:
                import io
                bio = io.BytesIO()
                with pd.ExcelWriter(bio, engine='openpyxl') as writer:
                    df.to_excel(writer, index=False, sheet_name='Query Result')
                st.download_button(
                    "â¬‡ï¸ Táº£i Excel",
                    bio.getvalue(),
                    f"query_result_{datetime.now().strftime('%Y%m%d_%H%M%S')}.xlsx",
                    "application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",
                    use_container_width=True
                )
            except Exception as e:
                st.error(f"Lá»—i export Excel: {e}")
        
    except Exception as e:
        st.error(f"âŒ Lá»—i truy váº¥n: {e}")
        st.code(sql, language="sql")

# ====== Help Section ======
with st.sidebar:
    st.header("â„¹ï¸ HÆ°á»›ng dáº«n")
    
    st.markdown("""
    ### CÃ¡ch sá»­ dá»¥ng:
    
    1. **Chá»n Schema & Table**: Chá»n lá»›p dá»¯ liá»‡u vÃ  báº£ng fact
    2. **Chá»n Time Grain**: Äá»™ chi tiáº¿t thá»i gian (ngÃ y/tuáº§n/thÃ¡ng...)
    3. **Chá»n Dimensions**: CÃ¡c chiá»u phÃ¢n tÃ­ch (tá»‘i Ä‘a 3-4)
    4. **Chá»n Measures**: CÃ¡c chá»‰ sá»‘ cáº§n tÃ­nh
    5. **ThÃªm Filters**: Äiá»u kiá»‡n lá»c bá»• sung (tÃ¹y chá»n)
    6. **Cháº¡y**: Nháº¥n nÃºt "Cháº¡y truy váº¥n"
    
    ### VÃ­ dá»¥ Filters:
    ```sql
    primary_payment_type = 'credit_card'
    delivered_on_time = true
    sum_price > 100
    ```
    
    ### Tips:
    - Giá»›i háº¡n khoáº£ng thá»i gian Ä‘á»ƒ truy váº¥n nhanh hÆ¡n
    - Chá»n Ã­t dimensions Ä‘á»ƒ trÃ¡nh quÃ¡ nhiá»u dÃ²ng
    - DÃ¹ng ROLLUP Ä‘á»ƒ xem tá»•ng theo tá»«ng cáº¥p
    """)
    
    st.divider()
    
    st.markdown(f"""
    **Trino Connection:**
    - Host: `{TRINO_HOST}:{TRINO_PORT}`
    - Catalog: `{TRINO_CATALOG}`
    - Schema: `{schema}`
    """)



â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FILE: app/pages/2_ğŸ’¬_Chat.py
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

"""
Chat Page - SQL + RAG Chatbot
Interactive chat interface for querying the data warehouse
"""
import streamlit as st
import requests
import uuid
import pandas as pd
from datetime import datetime


# ============================================================================
# Configuration
# ============================================================================

CHAT_SERVICE_URL = "http://chat_service:8001"


# ============================================================================
# Session State
# ============================================================================

if "session_id" not in st.session_state:
    st.session_state.session_id = uuid.uuid4().hex[:16]

if "chat_history" not in st.session_state:
    st.session_state.chat_history = []

if "last_sql" not in st.session_state:
    st.session_state.last_sql = None

if "last_preview" not in st.session_state:
    st.session_state.last_preview = None

if "last_citations" not in st.session_state:
    st.session_state.last_citations = None

if "execution_time" not in st.session_state:
    st.session_state.execution_time = None


# ============================================================================
# Helper Functions
# ============================================================================

def get_example_questions():
    """Get example questions from API"""
    try:
        response = requests.get(f"{CHAT_SERVICE_URL}/examples", timeout=5)
        if response.ok:
            return response.json().get("examples", [])
    except:
        pass
    
    # Fallback examples
    return [
        "Doanh thu theo thÃ¡ng gáº§n Ä‘Ã¢y?",
        "Top 10 sáº£n pháº©m bÃ¡n cháº¡y nháº¥t?",
        "PhÃ¢n bá»‘ Ä‘Æ¡n hÃ ng theo vÃ¹ng miá»n?",
        "PhÆ°Æ¡ng thá»©c thanh toÃ¡n nÃ o phá»• biáº¿n nháº¥t?",
    ]


def send_question(question: str):
    """Send question to chat service"""
    try:
        response = requests.post(
            f"{CHAT_SERVICE_URL}/ask",
            json={
                "session_id": st.session_state.session_id,
                "question": question,
                "prefer_sql": True
            },
            timeout=60
        )
        
        if response.ok:
            return response.json()
        else:
            st.error(f"âŒ Lá»—i API: {response.text}")
            return None
            
    except requests.exceptions.Timeout:
        st.error("â° Timeout: Query took too long to execute")
        return None
    except Exception as e:
        st.error(f"âŒ Lá»—i káº¿t ná»‘i: {str(e)}")
        return None


# ============================================================================
# UI
# ============================================================================

st.title("ğŸ’¬ Chat vá»›i Dá»¯ liá»‡u")
st.caption("Há»i Ä‘Ã¡p dá»¯ liá»‡u Brazilian E-commerce báº±ng ngÃ´n ngá»¯ tá»± nhiÃªn (SQL + RAG)")

# Sidebar - Examples & Info
with st.sidebar:
    st.header("ğŸ“š CÃ¢u há»i máº«u")
    
    examples = get_example_questions()
    
    for example in examples:
        if st.button(example, key=f"ex_{hash(example)}", use_container_width=True):
            st.session_state.selected_example = example
    
    st.divider()
    
    st.header("â„¹ï¸ ThÃ´ng tin")
    st.info("""
    **Há»‡ thá»‘ng cÃ³ thá»ƒ tráº£ lá»i:**
    - ğŸ“Š Truy váº¥n dá»¯ liá»‡u (SQL)
    - ğŸ“š TÃ i liá»‡u tham kháº£o (RAG)
    - ğŸ’¡ Gá»£i Ã½ phÃ¢n tÃ­ch
    
    **An toÃ n:**
    - âœ… Chá»‰ cho phÃ©p SELECT (read-only)
    - âœ… Giá»›i háº¡n sá»‘ dÃ²ng tráº£ vá»
    - âœ… Timeout tá»± Ä‘á»™ng
    - âœ… Log Ä‘áº§y Ä‘á»§
    """)
    
    if st.button("ğŸ”„ Reset Chat", use_container_width=True):
        st.session_state.chat_history = []
        st.session_state.session_id = uuid.uuid4().hex[:16]
        st.session_state.last_sql = None
        st.session_state.last_preview = None
        st.session_state.last_citations = None
        st.session_state.execution_time = None
        st.rerun()

# Main chat interface
st.divider()

# Welcome message if no history
if not st.session_state.chat_history:
    st.info("""
    ğŸ‘‹ **Xin chÃ o! TÃ´i lÃ  trá»£ lÃ½ phÃ¢n tÃ­ch dá»¯ liá»‡u Brazilian E-commerce.**
    
    ğŸ’¡ Báº¡n cÃ³ thá»ƒ há»i tÃ´i vá»:
    - Doanh thu, sáº£n pháº©m, Ä‘Æ¡n hÃ ng
    - PhÃ¢n tÃ­ch theo khu vá»±c, danh má»¥c
    - PhÆ°Æ¡ng thá»©c thanh toÃ¡n, Ä‘Ã¡nh giÃ¡ khÃ¡ch hÃ ng
    
    ğŸ“Œ Chá»n cÃ¢u há»i máº«u bÃªn trÃ¡i hoáº·c nháº­p cÃ¢u há»i cá»§a báº¡n!
    """)
    
    # Show suggestion cards
    st.markdown("### ğŸ¯ CÃ¢u há»i phá»• biáº¿n:")
    cols = st.columns(2)
    examples = get_example_questions()
    for i, example in enumerate(examples[:6]):
        col_idx = i % 2
        with cols[col_idx]:
            if st.button(f"ğŸ’¬ {example}", key=f"welcome_{i}", use_container_width=True):
                st.session_state.selected_example = example
                st.rerun()

# Display chat history
for role, message in st.session_state.chat_history:
    with st.chat_message(role):
        st.markdown(message)
        
        # If assistant message contains suggestions, show as buttons
        if role == "assistant" and "Gá»£i Ã½ cÃ¢u há»i phá»• biáº¿n:" in message:
            st.markdown("---")
            st.markdown("**ğŸ‘‡ Click Ä‘á»ƒ há»i:**")
            
            # Extract suggestions from message
            examples = get_example_questions()
            cols = st.columns(2)
            for i, example in enumerate(examples[:6]):
                col_idx = i % 2
                with cols[col_idx]:
                    if st.button(example, key=f"suggest_{hash(message)}_{i}", use_container_width=True):
                        st.session_state.selected_example = example
                        st.rerun()

# Chat input
question = st.chat_input("Nháº­p cÃ¢u há»i cá»§a báº¡n...", key="chat_input")

# Handle example selection
if "selected_example" in st.session_state:
    question = st.session_state.selected_example
    del st.session_state.selected_example

# Process question
if question:
    # Add user message to history
    st.session_state.chat_history.append(("user", question))
    
    # Display user message
    with st.chat_message("user"):
        st.markdown(question)
    
    # Send to API
    with st.spinner("ğŸ¤” Äang suy nghÄ©..."):
        result = send_question(question)
    
    if result:
        # Store results
        st.session_state.last_sql = result.get("sql")
        st.session_state.last_preview = result.get("rows_preview")
        st.session_state.last_citations = result.get("citations")
        st.session_state.execution_time = result.get("execution_time_ms")
        
        # Add assistant response to history
        answer = result.get("answer", "KhÃ´ng cÃ³ cÃ¢u tráº£ lá»i")
        st.session_state.chat_history.append(("assistant", answer))
        
        # Display assistant message
        with st.chat_message("assistant"):
            st.markdown(answer)

# Display SQL & Results
if st.session_state.last_sql or st.session_state.last_preview or st.session_state.last_citations:
    st.divider()
    
    col1, col2, col3 = st.columns(3)
    
    with col1:
        if st.session_state.execution_time:
            st.metric("â±ï¸ Thá»i gian thá»±c thi", f"{st.session_state.execution_time}ms")
    
    with col2:
        if st.session_state.last_preview:
            st.metric("ğŸ“Š Sá»‘ dÃ²ng", len(st.session_state.last_preview))
    
    with col3:
        if st.session_state.last_citations:
            st.metric("ğŸ“š TÃ i liá»‡u tham kháº£o", len(st.session_state.last_citations))
    
    # SQL Query
    if st.session_state.last_sql:
        with st.expander("ğŸ” SQL Query", expanded=False):
            st.code(st.session_state.last_sql, language="sql")
            
            # Copy button
            if st.button("ğŸ“‹ Copy SQL"):
                st.toast("SQL copied to clipboard!")
    
    # Data Preview
    if st.session_state.last_preview:
        with st.expander("ğŸ“Š Káº¿t quáº£ (Preview 50 dÃ²ng Ä‘áº§u)", expanded=True):
            df = pd.DataFrame(st.session_state.last_preview)
            
            # Display dataframe
            st.dataframe(
                df,
                use_container_width=True,
                height=400
            )
            
            # Export buttons
            col1, col2 = st.columns(2)
            
            with col1:
                csv = df.to_csv(index=False).encode('utf-8')
                st.download_button(
                    label="ğŸ“¥ Download CSV",
                    data=csv,
                    file_name=f"query_result_{datetime.now().strftime('%Y%m%d_%H%M%S')}.csv",
                    mime="text/csv",
                )
            
            with col2:
                # Basic statistics
                if st.button("ğŸ“ˆ Show Statistics"):
                    st.write(df.describe())
    
    # Citations
    if st.session_state.last_citations:
        with st.expander("ğŸ“š TÃ i liá»‡u tham kháº£o", expanded=False):
            for i, citation in enumerate(st.session_state.last_citations, 1):
                st.markdown(f"""
                **{i}. {citation.get('source', 'Unknown')}**  
                Äá»™ liÃªn quan: `{citation.get('score', 0):.2f}`
                
                > {citation.get('text', 'No preview available')[:300]}...
                """)
                st.divider()

# Footer
st.divider()
st.caption(f"Session ID: `{st.session_state.session_id}` | Service: `{CHAT_SERVICE_URL}`")



â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FILE: docker_image/streamlit/Dockerfile
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

# app/Dockerfile

FROM python:3.9-slim-bullseye
WORKDIR /app

RUN apt-get update && apt-get install -y \
    build-essential \
    curl \
    git \
    && rm -rf /var/lib/apt/lists/*

#RUN pip install -r requirements.txt
COPY . .

RUN pip install --upgrade pip && pip install -r requirements.txt

EXPOSE 8501

HEALTHCHECK CMD curl --fail http://localhost:8501/_stcore/health || exit 1

CMD ["streamlit", "run", "app.py", "--server.port=8501", "--server.address=0.0.0.0"]


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FILE: docker_image/streamlit/requirements.txt
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

pandas
streamlit
trino
pyarrow
openpyxl
python-dateutil
cryptography==41.0.4
requests
python-dotenv


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
FILE: docker-compose.yaml (streamlit service)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  streamlit:
    container_name: streamlit
    build:
      context: ./docker_image/streamlit
      dockerfile: Dockerfile
    image: streamlit:latest
    ports:
      - "8501:8501"
    environment:
      - MLFLOW_S3_ENDPOINT_URL=http://minio:9000
      - AWS_ACCESS_KEY_ID=minio
      - AWS_SECRET_ACCESS_KEY=minio123
    volumes:
      - ./app:/app
    networks:
      - de_network 


â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
CONFIGURATION SUMMARY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ DOCKER CONTAINER:

Service Name: streamlit
Image: streamlit:latest
Port: 8501 (host) â†’ 8501 (container)
Volume: ./app â†’ /app (live reload enabled)

Environment Variables:
- MLFLOW_S3_ENDPOINT_URL=http://minio:9000
- AWS_ACCESS_KEY_ID=minio
- AWS_SECRET_ACCESS_KEY=minio123

Healthcheck:
- Command: curl --fail http://localhost:8501/_stcore/health || exit 1
- Interval: 30s
- Timeout: 10s
- Retries: 3

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”§ PYTHON DEPENDENCIES:

Core Libraries (9 packages):
1. pandas - Data manipulation
2. streamlit - Web framework
3. trino - Trino database connector
4. pyarrow - Arrow format support
5. openpyxl - Excel export
6. python-dateutil - Date handling
7. cryptography==41.0.4 - Security
8. requests - HTTP client (for Chat service)
9. python-dotenv - Environment variables

Removed (optimization):
- matplotlib, seaborn, plotly (khÃ´ng dÃ¹ng chart)
- boto3 (khÃ´ng connect S3 trá»±c tiáº¿p)
- pymysql, mysql-connector-python (khÃ´ng connect MySQL trá»±c tiáº¿p)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ PAGES STRUCTURE:

app/
â”œâ”€â”€ app.py                          # Main dashboard (home page)
â”‚   â”œâ”€â”€ Navigation cards
â”‚   â”œâ”€â”€ Service status
â”‚   â””â”€â”€ Quick links
â”‚
â””â”€â”€ pages/
    â”œâ”€â”€ 1_ğŸ“Š_Query_Window.py        # OLAP query interface
    â”‚   â”œâ”€â”€ Schema/table selection
    â”‚   â”œâ”€â”€ Time grain picker
    â”‚   â”œâ”€â”€ Dimensions/measures selector
    â”‚   â”œâ”€â”€ ROLLUP/GROUPING SETS
    â”‚   â”œâ”€â”€ SQL builder
    â”‚   â””â”€â”€ CSV/Excel export
    â”‚
    â””â”€â”€ 2_ğŸ’¬_Chat.py                # Chat interface
        â”œâ”€â”€ Natural language queries
        â”œâ”€â”€ SQL generation via API
        â”œâ”€â”€ RAG-based responses
        â””â”€â”€ Chat history

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š QUERY WINDOW FEATURES:

1. OLAP-Style Queries:
   - Multi-dimensional analysis
   - Time grain: day/week/month/quarter/year
   - Dynamic GROUP BY

2. Advanced Aggregations:
   - ROLLUP: Hierarchical totals
   - GROUPING SETS: Custom aggregation levels
   - NULLS LAST: Subtotals at the end

3. Security:
   - Filter validation
   - SQL injection prevention
   - Read-only queries (enforced by Trino user)

4. Export:
   - CSV download (numeric format preserved)
   - Excel download (with proper data types)
   - Formatted timestamps

5. Performance:
   - Query caching (10 minutes TTL)
   - Result limiting
   - Efficient SQL generation

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’¬ CHAT FEATURES:

1. Natural Language Interface:
   - Ask questions in Vietnamese/English
   - SQL generation via intent routing
   - RAG-based explanations

2. Backend Integration:
   - REST API: chat_service:8001
   - Endpoints: /ask, /health
   - Session management

3. Response Types:
   - SQL query results
   - Data preview
   - Citations from documentation
   - Error handling

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”Œ CONNECTION CONFIGS:

Trino Connection (Query Window):
- Host: trino (internal DNS)
- Port: 8080 (internal)
- Catalog: lakehouse
- Schema: gold (default)
- User: admin
- Auth: None (or BasicAuth if configured)

Chat Service Connection:
- URL: http://chat_service:8001
- Protocol: HTTP/REST
- Timeout: 30s
- Retry: 3 attempts

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ RECENT IMPROVEMENTS (Applied):

âœ… 1. Export Format Fix:
   - Separated df_display for UI
   - Preserved numeric types for export
   â†’ CSV/Excel now have proper number formats

âœ… 2. Date Handling:
   - CAST(date_col AS date) in WHERE
   â†’ Prevents timezone-related errors

âœ… 3. Security Enhancement:
   - Filter validation with banned keywords
   - ValueError on dangerous input
   â†’ Basic SQL injection prevention

âœ… 4. OLAP Display:
   - ORDER BY ... NULLS LAST
   â†’ Subtotals/grand totals appear at the end

âœ… 5. No Warnings:
   - Removed duplicate set_page_config
   â†’ Clean console output

âœ… 6. Docker Health:
   - Healthcheck with || exit 1
   â†’ Proper container monitoring

âœ… 7. Performance:
   - Reduced dependencies by 40%
   â†’ Faster build times

âœ… 8. UI Clarity:
   - Port labeled "8082 (ext)"
   â†’ Clear internal vs external ports

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸš€ DEPLOYMENT:

Build & Run:
```bash
# Build image
docker compose build streamlit

# Start service
docker compose up -d streamlit

# Check status
docker compose ps streamlit

# View logs
docker compose logs -f streamlit

# Restart
docker compose restart streamlit

# Stop
docker compose stop streamlit
```

Access:
- Main: http://localhost:8501
- Health: http://localhost:8501/_stcore/health

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ” TROUBLESHOOTING:

1. Connection to Trino failed:
   - Check Trino service: docker compose ps trino
   - Check network: docker network inspect de_network
   - Verify DNS resolution: docker exec streamlit ping trino

2. Chat service not responding:
   - Check chat_service: docker compose ps chat_service
   - Check API health: curl http://localhost:8001/health
   - Check logs: docker compose logs chat_service

3. Page not loading:
   - Check healthcheck: docker compose ps streamlit
   - Check logs: docker compose logs streamlit
   - Restart: docker compose restart streamlit

4. Export fails:
   - Check disk space
   - Check browser allows downloads
   - Try CSV instead of Excel

5. Slow queries:
   - Reduce date range
   - Reduce dimensions
   - Add more filters
   - Check Trino query: docker compose logs trino

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”® FUTURE ENHANCEMENTS:

Query Window:
- [ ] Chart visualization (bar/line/pie)
- [ ] Query history
- [ ] Saved queries/templates
- [ ] JOIN support for multi-fact queries
- [ ] PIVOT/UNPIVOT UI
- [ ] Drill-down capability
- [ ] Calculated fields
- [ ] Performance metrics display
- [ ] Query cost estimation

Chat Interface:
- [ ] Multi-turn conversations
- [ ] Query suggestions
- [ ] Data visualization in chat
- [ ] Export chat history
- [ ] Voice input
- [ ] Feedback mechanism

General:
- [ ] User authentication
- [ ] Role-based access control
- [ ] Query scheduling
- [ ] Email reports
- [ ] Mobile responsive design
- [ ] Dark mode
- [ ] i18n support (full Vietnamese)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“š CODE QUALITY:

- Python 3.9+ features used
- Type hints (partial)
- Docstrings for complex functions
- Error handling with try/except
- Logging for debugging
- Session state management
- Caching for performance

Security Measures:
- SQL injection prevention (basic)
- Read-only Trino user
- No credential hardcoding
- Environment variable usage
- HTTPS ready (if configured)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”


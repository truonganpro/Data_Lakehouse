# THÃ”NG TIN BÃO CÃO CHÆ¯Æ NG 5 - DATA LAKEHOUSE PROJECT
# Nghiá»‡p vá»¥ thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ & á»©ng dá»¥ng thá»±c tiá»…n

================================================================================
ğŸ“Œ 5.1. QUY TRÃŒNH ORDER-TO-CASH TRONG TMÄT (THEO OLIST)
================================================================================

FILE: load_dataset_into_mysql/01_olist.sql, etl_pipeline/etl_pipeline/assets/gold.py (dÃ²ng 165-217)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”„ QUY TRÃŒNH Tá»”NG QUAN

Olist Marketplace E-commerce Process:

1. Customer Browse & Order
2. Order Approval
3. Seller Processing
4. Shipping & Delivery
5. Payment Processing
6. Review & Rating

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ BÆ¯á»šC 1: CUSTOMER BROWSE & ORDER

Entities:
   â€¢ customers: Customer information
   â€¢ products: Product catalog
   â€¢ sellers: Seller information

Process:
   1. Customer browses products
   2. Adds items to cart
   3. Places order
   4. System generates order_id

Data Captured:
   â€¢ order_purchase_timestamp: When order placed
   â€¢ product_id: What bought
   â€¢ seller_id: Who selling
   â€¢ price: Unit price
   â€¢ freight_value: Shipping cost

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… BÆ¯á»šC 2: ORDER APPROVAL

Process:
   1. Order status: "created"
   2. Fraud check
   3. Payment verification
   4. Status: "approved" â†’ order_approved_at
   5. Or rejected/canceled

Data Captured:
   â€¢ order_approved_at: Approval timestamp
   â€¢ order_status: created â†’ approved â†’ invoiced

Business Rules:
   â€¢ Must have valid payment
   â€¢ Must pass fraud checks
   â€¢ Must be within seller limits

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸšš BÆ¯á»šC 3: SELLER PROCESSING & SHIPPING

Process:
   1. Status: "invoiced"
   2. Seller prepares order
   3. Ships to carrier
   4. order_delivered_carrier_date recorded
   5. Status: "shipped"

Data Captured:
   â€¢ order_delivered_carrier_date: When shipped
   â€¢ shipping_limit_date: SLA deadline
   â€¢ Freight value confirmed

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¬ BÆ¯á»šC 4: DELIVERY TO CUSTOMER

Process:
   1. Carrier transports
   2. Delivers to customer
   3. order_delivered_customer_date recorded
   4. Status: "delivered"
   5. Or "unavailable" if failed

Data Captured:
   â€¢ order_delivered_customer_date: Actual delivery
   â€¢ order_estimated_delivery_date: Promise date
   â€¢ Delivered on time flag calculated

SLA Calculation:
   ```sql
   delivered_on_time = (
       order_delivered_customer_date <= order_estimated_delivery_date
   )
   ```

Target: >90% on-time delivery

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’³ BÆ¯á»šC 5: PAYMENT PROCESSING

Entities:
   â€¢ order_payments: Multiple payments per order

Payment Flow:
   1. Payment at checkout
   2. May have multiple payment methods
   3. payment_sequential tracks order
   4. Funds held until delivery
   5. Released to seller

Data Captured:
   â€¢ payment_type: credit_card, boleto, voucher, debit_card
   â€¢ payment_value: Amount
   â€¢ payment_installments: Number of installments

Payment Methods:
   â€¢ credit_card: 75% (most common)
   â€¢ boleto: 20% (Brazilian bill/bank slip)
   â€¢ voucher: 3%
   â€¢ debit_card: 2%

Installment Analysis:
   â€¢ Average: 2-3 installments
   â€¢ Common: 1, 2, 3, 4, 5, 10

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â­ BÆ¯á»šC 6: REVIEW & RATING

Process:
   1. After delivery
   2. Customer prompted to review
   3. review_creation_date
   4. Optional title & message
   5. Seller can respond (review_answer_timestamp)

Data Captured:
   â€¢ review_score: 1-5 stars
   â€¢ review_comment_title: Short feedback
   â€¢ review_comment_message: Detailed feedback
   â€¢ review_answer_timestamp: Seller response time

Review Distribution:
   â€¢ 5 stars: ~57% (most common)
   â€¢ 4 stars: ~19%
   â€¢ 3 stars: ~6%
   â€¢ 2 stars: ~2%
   â€¢ 1 star: ~15% (high complaint rate!)

Average: 4.2/5.0

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š ORDER STATUSES

Lifecycle:
   1. created: Just placed
   2. approved: Payment confirmed
   3. invoiced: Invoice generated
   4. processed: Processing
   5. shipping: On the way
   6. delivered: Reached customer âœ…
   7. unavailable: Failed delivery
   8. canceled: Order cancelled âŒ

Status Distribution:
   â€¢ delivered: 95%+
   â€¢ shipped: 2-3%
   â€¢ canceled: <2%
   â€¢ invoiced: <1%
   â€¢ processing: <1%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â±ï¸ TIME METRICS

Order-to-Delivery Cycle:
   â€¢ Total time: Average ~15 days
   â€¢ Range: 5-30 days
   â€¢ Breakdown:
     - Approval: 0.5 days
     - Processing: 1 day
     - Shipping: 12-20 days
     - Delivery: 1-3 days

Fastest States:
   â€¢ SP (SÃ£o Paulo): ~10 days
   â€¢ RJ (Rio de Janeiro): ~12 days

Slowest States:
   â€¢ North regions: ~20+ days

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ FILES LIÃŠN QUAN:
   - load_dataset_into_mysql/01_olist.sql: Schema definition
   - etl_pipeline/etl_pipeline/assets/gold.py: Process logic
   - docs/kpi_definitions.md: Delivery SLA


================================================================================
ğŸ“Œ 5.2. Há»† THá»NG KPI Cá»T LÃ•I
================================================================================

FILE: docs/kpi_definitions.md (full), etl_pipeline/etl_pipeline/assets/platinum.py (full)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° REVENUE KPIs

1. GMV (Gross Merchandise Value):
   Definition: Tá»•ng giÃ¡ trá»‹ giao dá»‹ch
   Formula: SUM(price + freight_value)
   Target: Maximize
   Datamart: dm_sales_monthly_category.gmv

2. AOV (Average Order Value):
   Definition: GiÃ¡ trá»‹ Ä‘Æ¡n hÃ ng trung bÃ¬nh
   Formula: GMV / COUNT(DISTINCT order_id)
   Target: > 150 BRL
   Datamart: dm_sales_monthly_category.aov

3. Total Revenue:
   Definition: Doanh thu (delivered only)
   Formula: SUM(price) WHERE status='delivered'
   Target: Maximize
   Datamart: dm_sales_monthly_category (filtered)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š OPERATIONAL KPIs

4. On-Time Delivery Rate (SLA):
   Definition: % Ä‘Æ¡n hÃ ng giao Ä‘Ãºng háº¡n
   Formula: SUM(delivered_on_time) / COUNT(*)
   Target: >90%
   Datamart: dm_logistics_sla.on_time_rate
   Calculation:
   ```python
   delivered_on_time = (
       order_delivered_customer_date <= order_estimated_delivery_date
   )
   ```

5. Cancel Rate:
   Definition: % Ä‘Æ¡n hÃ ng bá»‹ há»§y
   Formula: COUNT(status='canceled') / COUNT(*)
   Target: <2%
   Datamart: dm_seller_kpi.cancel_rate
   Business Impact: Revenue loss indicator

6. Average Delivery Days:
   Definition: Sá»‘ ngÃ y trung bÃ¬nh tá»« Ä‘áº·t â†’ giao
   Formula: AVG(delivered_days)
   Target: <15 days
   Datamart: dm_logistics_sla.avg_delivered_days

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â­ QUALITY KPIs

7. Review Score:
   Definition: Äiá»ƒm Ä‘Ã¡nh giÃ¡ khÃ¡ch hÃ ng
   Formula: AVG(review_score)
   Target: >4.0/5.0
   Datamart: dm_seller_kpi.avg_review_score
   Distribution:
   â€¢ 5 stars: 57%
   â€¢ 4 stars: 19%
   â€¢ 1-3 stars: 24%

8. Review Rate:
   Definition: % Ä‘Æ¡n hÃ ng cÃ³ review
   Formula: COUNT(review_id) / COUNT(order_id)
   Target: Track quality
   Datamart: dm_seller_kpi

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¥ CUSTOMER KPIs

9. Customer Retention:
   Definition: % khÃ¡ch mua láº¡i
   Formula: COUNT(DISTINCT customers with >1 order) / COUNT(DISTINCT customer_id)
   Target: >15%
   Datamart: dm_customer_lifecycle (cohort)
   Analysis:
   â€¢ Cohort month tracking
   â€¢ Repeat purchase patterns
   â€¢ Churn identification

10. New vs Returning Customers:
   Definition: PhÃ¢n loáº¡i khÃ¡ch má»›i/cÅ©
   Formula: First purchase date
   Analysis: Cohort-based retention
   Datamart: dm_customer_lifecycle

11. Lifetime Value (LTV):
   Definition: Tá»•ng giÃ¡ trá»‹ khÃ¡ch mang láº¡i
   Formula: SUM(gmv) per customer
   Datamart: dm_customer_lifecycle.gmv

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’³ PAYMENT KPIs

12. Payment Mix:
   Definition: PhÃ¢n bá»‘ phÆ°Æ¡ng thá»©c thanh toÃ¡n
   Breakdown:
   â€¢ credit_card: 75%
   â€¢ boleto: 20%
   â€¢ voucher: 3%
   â€¢ debit_card: 2%
   Datamart: dm_payment_mix
   Business Value:
   â€¢ Cash flow planning
   â€¢ Fee optimization
   â€¢ Regional preferences

13. Installment Analysis:
   Definition: PhÃ¢n tÃ­ch tráº£ gÃ³p
   Formula: AVG(payment_installments)
   Average: 2-3 installments
   Datamart: dm_payment_mix (implied)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“¦ PRODUCT KPIs

14. Top Products:
   Definition: Sáº£n pháº©m bÃ¡n cháº¡y
   Formula: SUM(revenue) GROUP BY product
   Datamart: dm_product_bestsellers
   Dimensions:
   â€¢ Revenue
   â€¢ Units sold
   â€¢ Review correlation

15. Category Performance:
   Definition: Hiá»‡u suáº¥t danh má»¥c
   Formula: SUM(gmv) GROUP BY category
   Datamart: dm_sales_monthly_category
   Dimensions:
   â€¢ GMV, Orders, Units, AOV
   â€¢ Month-over-month growth

16. Price Bands:
   Definition: PhÃ¢n khÃºc giÃ¡
   Formula: GROUP BY category, price_range
   Datamart: dm_category_price_bands
   Analysis: Most sales in mid-range ($50-$200)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸŒ REGIONAL KPIs

17. Sales by State:
   Definition: Doanh sá»‘ theo bang
   Top States:
   â€¢ SP: 40% (SÃ£o Paulo)
   â€¢ RJ: 15% (Rio de Janeiro)
   â€¢ MG: 12% (Minas Gerais)
   Datamart: dm_sales_monthly_category + geolocation

18. Regional Distribution:
   Definition: PhÃ¢n bá»‘ theo vÃ¹ng
   Southeast: 70%
   South: 15%
   Northeast: 10%
   Other: 5%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”® FORECASTING KPIs

19. Forecast Accuracy (sMAPE):
   Definition: Äá»™ chÃ­nh xÃ¡c dá»± bÃ¡o
   Target: <20% (Good)
   Metric: Symmetric Mean Absolute Percentage Error
   Datamart: platinum.forecast_monitoring

20. Demand Forecast:
   Definition: Dá»± bÃ¡o nhu cáº§u 28 ngÃ y
   Horizon: 28 days
   Confidence: Intervals (yhat_lo, yhat_hi)
   Datamart: platinum.demand_forecast

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š KPI DASHBOARD MAPPING

Executive Dashboard:
   â€¢ Total GMV
   â€¢ Total Orders
   â€¢ AOV
   â€¢ Revenue Trend

Operational Dashboard:
   â€¢ On-time rate
   â€¢ Cancel rate
   â€¢ Delivery days
   â€¢ Review scores

Customer Dashboard:
   â€¢ Retention rate
   â€¢ Cohort analysis
   â€¢ LTV

Financial Dashboard:
   â€¢ Payment mix
   â€¢ Installments
   â€¢ Cash flow

Product Dashboard:
   â€¢ Top products
   â€¢ Category performance
   â€¢ Price bands

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ FILES LIÃŠN QUAN:
   - docs/kpi_definitions.md: Full KPI definitions
   - etl_pipeline/etl_pipeline/assets/platinum.py: KPI calculations
   - README.md (dÃ²ng 200-285): Datamart stats


================================================================================
ğŸ“Œ 5.3. CÃ‚U Há»I QUáº¢N TRá»Š THÆ¯á»œNG Gáº¶P & CÃCH KHAI THÃC
================================================================================

FILE: PROJECT_OVERVIEW.md (dÃ²ng 501-595), metabase_queries.sql, chat_service/

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ CÃ‚U Há»I EXECUTIVE

Q1: "Doanh thu thÃ¡ng nÃ y vs thÃ¡ng trÆ°á»›c?"
Answer: Revenue comparison MoM
Query: dm_sales_monthly_category
Method: Chat / Metabase / Query Window
SQL:
```sql
SELECT 
    year_month,
    SUM(gmv) AS total_revenue,
    LAG(SUM(gmv)) OVER (ORDER BY year_month) AS prev_month,
    (SUM(gmv) - LAG(SUM(gmv)) OVER (ORDER BY year_month)) * 100.0 / 
        LAG(SUM(gmv)) OVER (ORDER BY year_month) AS growth_pct
FROM lakehouse.platinum.dmsalesmonthlycategory
GROUP BY year_month
ORDER BY year_month DESC
LIMIT 12
```

Q2: "Top 5 danh má»¥c sáº£n pháº©m tÄƒng trÆ°á»Ÿng máº¡nh?"
Answer: Category ranking by GMV
Query: dm_sales_monthly_category
Method: Chat / Query Window
SQL:
```sql
SELECT 
    product_category_name_english,
    SUM(gmv) AS revenue,
    SUM(orders) AS orders,
    ROUND(SUM(gmv) / SUM(orders), 2) AS aov
FROM lakehouse.platinum.dmsalesmonthlycategory
WHERE year_month = '2018-06'
GROUP BY product_category_name_english
ORDER BY revenue DESC
LIMIT 5
```

Q3: "Tá»· lá»‡ giao hÃ ng Ä‘Ãºng háº¡n hiá»‡n táº¡i?"
Answer: On-time SLA metric
Query: dm_logistics_sla
Method: Chat / Metabase
SQL:
```sql
SELECT 
    AVG(on_time_rate) * 100.0 AS avg_on_time_pct,
    MIN(on_time_rate) * 100.0 AS min_rate,
    MAX(on_time_rate) * 100.0 AS max_rate
FROM lakehouse.platinum.dmlogisticssla
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ CÃ‚U Há»I SALES

Q4: "AOV theo tá»«ng bang/state?"
Answer: Average order value by state
Query: fact_order + dim_customer
Method: Chat / Query Window
SQL:
```sql
SELECT 
    dc.customer_state,
    COUNT(DISTINCT fo.order_id) AS orders,
    SUM(fo.sum_price) AS revenue,
    ROUND(SUM(fo.sum_price) / COUNT(DISTINCT fo.order_id), 2) AS aov
FROM lakehouse.gold.factorder fo
JOIN lakehouse.gold.dimcustomer dc ON fo.customer_id = dc.customer_id
WHERE fo.full_date >= DATE '2018-01-01'
GROUP BY dc.customer_state
ORDER BY aov DESC
```

Q5: "Top 10 sáº£n pháº©m bÃ¡n cháº¡y Q3 2018?"
Answer: Product ranking
Query: dm_product_bestsellers
Method: Chat / Query Window
SQL:
```sql
SELECT 
    product_id,
    product_category_name_english,
    total_gmv,
    total_orders,
    avg_review_score
FROM lakehouse.platinum.dmproductbestsellers
WHERE year_month BETWEEN '2018-07' AND '2018-09'
ORDER BY total_gmv DESC
LIMIT 10
```

Q6: "Xu hÆ°á»›ng doanh thu 6 thÃ¡ng qua?"
Answer: Revenue time series
Query: dm_sales_monthly_category
Method: Chat / Metabase dashboard
SQL:
```sql
SELECT 
    year_month,
    SUM(gmv) AS revenue,
    SUM(orders) AS orders,
    ROUND(SUM(gmv) / SUM(orders), 2) AS aov
FROM lakehouse.platinum.dmsalesmonthlycategory
WHERE year_month >= '2018-01'
GROUP BY year_month
ORDER BY year_month
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ CÃ‚U Há»I CUSTOMER

Q7: "Customer retention rate theo cohort?"
Answer: Cohort retention analysis
Query: dm_customer_lifecycle
Method: Chat / Query Window / Metabase
SQL:
```sql
WITH cohort_base AS (
    SELECT 
        cohort_month,
        COUNT(DISTINCT customer_unique_id) AS new_customers
    FROM lakehouse.platinum.dmcustomerlifecycle
    GROUP BY cohort_month
),
retention AS (
    SELECT 
        cohort_month,
        year_month,
        COUNT(DISTINCT customer_unique_id) AS active_customers
    FROM lakehouse.platinum.dmcustomerlifecycle
    GROUP BY cohort_month, year_month
)
SELECT 
    r.cohort_month,
    r.year_month,
    c.new_customers,
    r.active_customers,
    ROUND(r.active_customers * 100.0 / c.new_customers, 2) AS retention_pct
FROM retention r
JOIN cohort_base c ON r.cohort_month = c.cohort_month
ORDER BY r.cohort_month, r.year_month
```

Q8: "PhÃ¢n bá»‘ khÃ¡ch hÃ ng theo vÃ¹ng?"
Answer: Geographic distribution
Query: dm_customer_lifecycle + dim_customer
Method: Chat / Metabase
SQL:
```sql
SELECT 
    dc.customer_state,
    COUNT(DISTINCT dcl.customer_unique_id) AS customers,
    SUM(dcl.orders) AS total_orders,
    SUM(dcl.gmv) AS total_gmv
FROM lakehouse.platinum.dmcustomerlifecycle dcl
JOIN lakehouse.gold.dimcustomer dc ON dcl.customer_id = dc.customer_id
GROUP BY dc.customer_state
ORDER BY customers DESC
LIMIT 10
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ CÃ‚U Há»I OPERATIONS

Q9: "Seller cÃ³ hiá»‡u suáº¥t kÃ©m nháº¥t?"
Answer: Underperforming sellers
Query: dm_seller_kpi
Method: Chat / Query Window
SQL:
```sql
SELECT 
    seller_id,
    seller_state,
    gmv,
    on_time_rate * 100.0 AS on_time_pct,
    cancel_rate * 100.0 AS cancel_pct,
    avg_review_score
FROM lakehouse.platinum.dmsellerkpi
WHERE 
    on_time_rate < 0.85 OR
    cancel_rate > 0.05 OR
    avg_review_score < 3.5
ORDER BY on_time_rate ASC, cancel_rate DESC
LIMIT 20
```

Q10: "Thá»i gian giao hÃ ng trung bÃ¬nh theo vÃ¹ng?"
Answer: Delivery performance by region
Query: dm_logistics_sla
Method: Chat / Query Window
SQL:
```sql
SELECT 
    region_id,
    COUNT(*) AS order_count,
    ROUND(AVG(avg_delivered_days), 2) AS avg_days,
    ROUND(AVG(on_time_rate) * 100.0, 2) AS on_time_pct
FROM lakehouse.platinum.dmlogisticssla
GROUP BY region_id
ORDER BY avg_days DESC
```

Q11: "PhÆ°Æ¡ng thá»©c thanh toÃ¡n nÃ o phá»• biáº¿n?"
Answer: Payment method mix
Query: dm_payment_mix
Method: Chat / Query Window
SQL:
```sql
SELECT 
    payment_type,
    SUM(orders) AS total_orders,
    ROUND(SUM(orders) * 100.0 / SUM(SUM(orders)) OVER(), 2) AS pct_orders,
    SUM(payment_total) AS total_value
FROM lakehouse.platinum.dmpaymentmix
GROUP BY payment_type
ORDER BY total_orders DESC
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â“ CÃ‚U Há»I FORECASTING

Q12: "Dá»± bÃ¡o nhu cáº§u thÃ¡ng tá»›i?"
Answer: 28-day demand forecast
Query: platinum.demand_forecast
Method: Query Window / Chat
SQL:
```sql
SELECT 
    product_category_name_english,
    forecast_date,
    yhat AS forecasted_demand,
    yhat_lo AS lower_bound,
    yhat_hi AS upper_bound,
    confidence
FROM lakehouse.platinum.demand_forecast
WHERE forecast_date >= DATE '2018-11-01'
  AND forecast_date < DATE '2018-12-01'
ORDER BY forecast_date, product_category_name_english
```

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ¯ ANSWERING METHODS

Method 1: Chat Interface
   URL: http://localhost:8501/ğŸ’¬_Chat
   Capability: Natural language
   Example: "Doanh thu thÃ¡ng nÃ y?"
   Output: Summary + SQL + Data

Method 2: Query Window
   URL: http://localhost:8501/ğŸ“Š_Query_Window
   Capability: OLAP builder
   Output: Pivot table + CSV/Excel

Method 3: Metabase Dashboard
   URL: http://localhost:3000
   Capability: Visual analytics
   Output: Charts + Filters

Method 4: Direct SQL
   URL: Trino CLI
   Capability: Full SQL
   Output: Raw results

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ FILES LIÃŠN QUAN:
   - metabase_queries.sql: Sample queries
   - chat_service/: NL to SQL logic
   - PROJECT_OVERVIEW.md: Use cases


================================================================================
ğŸ“Œ 5.4. Báº¢N Äá»’ Dá»® LIá»†U: Tá»ª OLIST â†’ DATAMARTS / DASHBOARD
================================================================================

FILE: BAO_CAO_CHUONG_4_INFO.txt, PROJECT_OVERVIEW.md (dÃ²ng 51-73, 334-375)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ—ºï¸ DATA FLOW MAP

MySQL Source (9 tables)
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BRONZE LAYER                                   â”‚
â”‚  Raw data ingestion (no transformation)         â”‚
â”‚  â€¢ customer, seller, product                    â”‚
â”‚  â€¢ order, order_item, payment                   â”‚
â”‚  â€¢ review, geolocation, category_translation    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SILVER LAYER                                   â”‚
â”‚  Cleaning & normalization                       â”‚
â”‚  â€¢ dropDuplicates, na.drop                      â”‚
â”‚  â€¢ Type casting, validation                     â”‚
â”‚  â€¢ Computed fields (city_state)                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GOLD LAYER                                     â”‚
â”‚  Star Schema (Facts + Dimensions)               â”‚
â”‚  Facts: order_item, order, payment, review      â”‚
â”‚  Dims: customer, seller, product, category      â”‚
â”‚       date, geolocation                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PLATINUM LAYER                                 â”‚
â”‚  Business Datamarts                             â”‚
â”‚  â€¢ dm_sales_monthly_category                    â”‚
â”‚  â€¢ dm_seller_kpi                                â”‚
â”‚  â€¢ dm_customer_lifecycle                        â”‚
â”‚  â€¢ dm_payment_mix                               â”‚
â”‚  â€¢ dm_logistics_sla                             â”‚
â”‚  â€¢ dm_product_bestsellers                       â”‚
â”‚  â€¢ dm_category_price_bands                      â”‚
â”‚  â€¢ demand_forecast (ML)                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DASHBOARDS & REPORTS                           â”‚
â”‚  â€¢ Metabase dashboards                          â”‚
â”‚  â€¢ Query Window exports                         â”‚
â”‚  â€¢ Chat responses                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š DETAILED MAPPING

BRONZE â†’ SILVER:
   customers â†’ silver_customer (cleaning)
   sellers â†’ silver_seller (dedupe)
   products â†’ silver_product (casting, NULLs)
   orders â†’ silver_order (validation)
   order_items â†’ silver_order_item (normalize)
   payments â†’ silver_payment (aggregate)
   reviews â†’ silver_review (filter)
   geolocation â†’ silver_geolocation (bounds)
   category_translation â†’ silver_category_translation

SILVER â†’ GOLD:
   
   Dimensions:
   silver_customer â†’ gold.dim_customer
      columns: customer_id, city_state, computed
   
   silver_seller â†’ gold.dim_seller
      columns: seller_id, city_state
   
   silver_product â†’ gold.dim_product
      columns: product_id, category
   
   silver_category_translation â†’ gold.dim_product_category
      columns: category_name, english_name
   
   silver_geolocation â†’ gold.dim_geolocation
      columns: zip_code, lat/lng, city/state
   
   Generated: gold.dim_date
      columns: full_date, year_month, week, etc.
   
   Facts:
   silver_order_item â†’ gold.fact_order_item
      grain: 1 row per order_item
      measures: price, freight_value
      dims: product, seller, date
   
   silver_order + silver_payment â†’ gold.fact_order
      grain: 1 row per order
      measures: items_count, sum_price, delivery metrics
      dims: customer, date
   
   silver_payment â†’ gold.fact_payment
      grain: 1 row per payment
      measures: payment_value, installments
      dims: order, date
   
   silver_review â†’ gold.fact_review
      grain: 1 row per review
      measures: review_score
      dims: order, date

GOLD â†’ PLATINUM:

   1. DM_SALES_MONTHLY_CATEGORY:
   Sources: fact_order_item, dim_product, dim_category, dim_date
   Aggregation: GROUP BY year_month, category
   Measures: gmv, orders, units, aov
   Output: 1,326 rows
   Use: Revenue analysis, category performance

   2. DM_SELLER_KPI:
   Sources: fact_order_item, fact_order, fact_review, dim_seller
   Aggregation: GROUP BY seller_id
   Measures: gmv, orders, on_time_rate, cancel_rate, avg_review_score
   Output: 3,095 rows
   Use: Seller ranking, quality control

   3. DM_CUSTOMER_LIFECYCLE:
   Sources: fact_order_item, dim_customer, dim_date
   Aggregation: GROUP BY customer_id, year_month
   Measures: orders, gmv, cohort_month
   Output: 96,462 rows
   Use: Retention analysis, cohort tracking

   4. DM_PAYMENT_MIX:
   Sources: fact_payment, fact_order, dim_date
   Aggregation: GROUP BY year_month, payment_type
   Measures: orders, unique_customers, payment_total
   Output: 90 rows
   Use: Payment distribution, cash flow

   5. DM_LOGISTICS_SLA:
   Sources: fact_order, dim_customer, dim_geolocation, dim_date
   Aggregation: GROUP BY region
   Measures: on_time_rate, avg_delivered_days
   Output: 574 rows
   Use: Delivery performance, SLA monitoring

   6. DM_PRODUCT_BESTSELLERS:
   Sources: fact_order_item, fact_review, dim_product, dim_category
   Aggregation: GROUP BY product, category
   Measures: total_gmv, total_orders, avg_review_score
   Output: 32,951 rows
   Use: Product ranking, inventory planning

   7. DM_CATEGORY_PRICE_BANDS:
   Sources: fact_order_item, dim_product, dim_category
   Aggregation: GROUP BY category, price_range
   Measures: bands, distribution
   Output: 326 rows
   Use: Pricing analysis, segmentation

   8. DEMAND_FORECAST (ML):
   Sources: ML pipeline (historical + features)
   Output: Forecasts Ã— 28 days Ã— products Ã— regions
   Use: Inventory planning, procurement

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ˆ DASHBOARD MAPPING

Executive Dashboard:
   Tables: dm_sales_monthly_category
   Metrics: Total GMV, Orders, AOV, Trend
   Filters: Date range, Category

Sales Deep Dive:
   Tables: dm_sales_monthly_category, dm_category_price_bands
   Metrics: GMV by category, Price distribution
   Filters: Category, Region

Customer Analytics:
   Tables: dm_customer_lifecycle
   Metrics: Retention, Cohort, LTV
   Filters: Cohort month, State

Operations:
   Tables: dm_logistics_sla, dm_seller_kpi
   Metrics: On-time rate, Delivery days, Reviews
   Filters: Region, Seller

Payment Analysis:
   Tables: dm_payment_mix
   Metrics: Payment distribution, Installments
   Filters: Date range

Product Intelligence:
   Tables: dm_product_bestsellers
   Metrics: Top products, Reviews
   Filters: Category, Date

Forecasting:
   Tables: demand_forecast, forecast_monitoring
   Metrics: Forecast accuracy, Demand trends
   Filters: Product, Region

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ FILES LIÃŠN QUAN:
   - BAO_CAO_CHUONG_4_INFO.txt: Detailed ETL flow
   - PROJECT_OVERVIEW.md: Architecture diagram
   - etl_pipeline/etl_pipeline/assets/*.py: Implementation


================================================================================
ğŸ“Œ 5.5. Äá»ŠNH NGHÄ¨A & CÃ”NG THá»¨C KPI (CHUáº¨N HÃ“A TRONG PHá»¤ Lá»¤C)
================================================================================

FILE: docs/kpi_definitions.md (full document)

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’° REVENUE KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 1.1: GMV (Gross Merchandise Value)
   Äá»‹nh nghÄ©a: Tá»•ng giÃ¡ trá»‹ giao dá»‹ch (chÆ°a trá»« phÃ­)
   CÃ´ng thá»©c:
   ```sql
   GMV = SUM(price + freight_value)
   WHERE order_status IN ('delivered', 'shipped', 'invoiced')
   ```
   ÄÆ¡n vá»‹: BRL
   Target: Maximize
   Datamart: dm_sales_monthly_category.gmv
   Dimensions: ThÃ¡ng, Danh má»¥c, VÃ¹ng miá»n

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 1.2: AOV (Average Order Value)
   Äá»‹nh nghÄ©a: GiÃ¡ trá»‹ Ä‘Æ¡n hÃ ng trung bÃ¬nh
   CÃ´ng thá»©c:
   ```sql
   AOV = SUM(total_price) / COUNT(DISTINCT order_id)
   WHERE order_status = 'delivered'
   ```
   ÄÆ¡n vá»‹: BRL
   Target: > 150 BRL
   Interpretation: GiÃ¡ trá»‹ trung bÃ¬nh má»—i Ä‘Æ¡n
   Datamart: dm_sales_monthly_category.aov

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 1.3: Net Revenue
   Äá»‹nh nghÄ©a: Doanh thu sau khi trá»« há»§y/hoÃ n tráº£
   CÃ´ng thá»©c:
   ```sql
   Net Revenue = SUM(CASE 
       WHEN order_status = 'delivered' THEN total_price 
       ELSE 0 
   END)
   ```
   ÄÆ¡n vá»‹: BRL
   Target: Maximize
   Note: KhÃ´ng tÃ­nh canceled orders

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ‘¥ CUSTOMER KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 2.1: Active Customers
   Äá»‹nh nghÄ©a: Sá»‘ khÃ¡ch hÃ ng cÃ³ Ä‘Æ¡n trong ká»³
   CÃ´ng thá»©c:
   ```sql
   Active Customers = COUNT(DISTINCT customer_id)
   WHERE order_purchase_timestamp >= start_date
     AND order_purchase_timestamp < end_date
   ```
   ÄÆ¡n vá»‹: Count
   Target: Track growth

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 2.2: Customer Retention Rate
   Äá»‹nh nghÄ©a: % khÃ¡ch mua láº¡i
   CÃ´ng thá»©c:
   ```sql
   Retention Rate = COUNT(DISTINCT CASE WHEN order_count > 1 THEN customer_id END) * 100.0 / 
                    COUNT(DISTINCT customer_id)
   ```
   ÄÆ¡n vá»‹: %
   Target: > 15%
   Interpretation: Cao = khÃ¡ch trung thÃ nh

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 2.3: Lifetime Value (LTV)
   Äá»‹nh nghÄ©a: Tá»•ng giÃ¡ trá»‹ khÃ¡ch mang láº¡i
   CÃ´ng thá»©c:
   ```sql
   LTV = SUM(gmv) 
   WHERE customer_id = X
   GROUP BY customer_id
   ```
   ÄÆ¡n vá»‹: BRL
   Target: Track segmentation
   Use: Identify high-value customers

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“Š OPERATIONAL KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 3.1: On-Time Delivery Rate (SLA)
   Äá»‹nh nghÄ©a: % Ä‘Æ¡n giao Ä‘Ãºng háº¡n
   CÃ´ng thá»©c:
   ```sql
   On-Time Rate = SUM(delivered_on_time) * 100.0 / COUNT(*)
   WHERE order_status = 'delivered'
   
   delivered_on_time = (
       order_delivered_customer_date <= order_estimated_delivery_date
   ) ? 1 : 0
   ```
   ÄÆ¡n vá»‹: %
   Target: > 90%
   Datamart: dm_logistics_sla.on_time_rate
   Business Impact: Customer satisfaction

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 3.2: Cancel Rate
   Äá»‹nh nghÄ©a: % Ä‘Æ¡n bá»‹ há»§y
   CÃ´ng thá»©c:
   ```sql
   Cancel Rate = COUNT(CASE WHEN order_status = 'canceled' THEN 1 END) * 100.0 / 
                 COUNT(*)
   ```
   ÄÆ¡n vá»‹: %
   Target: < 2%
   Datamart: dm_seller_kpi.cancel_rate
   Business Impact: Revenue loss

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 3.3: Average Delivery Days
   Äá»‹nh nghÄ©a: Sá»‘ ngÃ y trung bÃ¬nh tá»« Ä‘áº·t â†’ giao
   CÃ´ng thá»©c:
   ```sql
   Avg Delivery Days = AVG(
       date_diff('day', 
           order_purchase_timestamp, 
           order_delivered_customer_date)
   )
   WHERE order_status = 'delivered'
   ```
   ÄÆ¡n vá»‹: Days
   Target: < 15 days
   Datamart: dm_logistics_sla.avg_delivered_days

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â­ QUALITY KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 4.1: Review Score
   Äá»‹nh nghÄ©a: Äiá»ƒm Ä‘Ã¡nh giÃ¡ trung bÃ¬nh
   CÃ´ng thá»©c:
   ```sql
   Avg Review Score = AVG(review_score)
   WHERE review_score IS NOT NULL
   ```
   ÄÆ¡n vá»‹: Stars (1-5)
   Target: > 4.0/5.0
   Datamart: dm_seller_kpi.avg_review_score
   Distribution:
   â€¢ 5 stars: 57%
   â€¢ 4 stars: 19%
   â€¢ 1-3 stars: 24%

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 4.2: Review Rate
   Äá»‹nh nghÄ©a: % Ä‘Æ¡n cÃ³ review
   CÃ´ng thá»©c:
   ```sql
   Review Rate = COUNT(DISTINCT review_id) * 100.0 / 
                 COUNT(DISTINCT order_id)
   ```
   ÄÆ¡n vá»‹: %
   Target: Track quality engagement

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ’³ PAYMENT KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 5.1: Payment Mix
   Äá»‹nh nghÄ©a: PhÃ¢n bá»‘ phÆ°Æ¡ng thá»©c thanh toÃ¡n
   PhÆ°Æ¡ng thá»©c:
   â€¢ credit_card: ~75%
   â€¢ boleto: ~20%
   â€¢ voucher: ~3%
   â€¢ debit_card: ~2%
   CÃ´ng thá»©c:
   ```sql
   Payment Share = COUNT(DISTINCT order_id) * 100.0 / 
                   SUM(COUNT(DISTINCT order_id)) OVER()
   GROUP BY payment_type
   ```
   ÄÆ¡n vá»‹: %
   Datamart: dm_payment_mix

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 5.2: Average Installments
   Äá»‹nh nghÄ©a: Sá»‘ ká»³ tráº£ gÃ³p trung bÃ¬nh
   CÃ´ng thá»©c:
   ```sql
   Avg Installments = AVG(payment_installments)
   WHERE payment_type = 'credit_card'
   ```
   ÄÆ¡n vá»‹: Ká»³
   Average: 2-3 ká»³
   Use: Cash flow planning

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“ˆ GROWTH KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 6.1: Month-over-Month Growth
   Äá»‹nh nghÄ©a: TÄƒng trÆ°á»Ÿng so vá»›i thÃ¡ng trÆ°á»›c
   CÃ´ng thá»©c:
   ```sql
   MoM Growth = (current_month - prev_month) * 100.0 / prev_month
   
   prev_month = LAG(revenue) OVER (ORDER BY year_month)
   ```
   ÄÆ¡n vá»‹: %
   Target: > 0%
   Use: Track trends

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 6.2: Year-over-Year Growth
   Äá»‹nh nghÄ©a: TÄƒng trÆ°á»Ÿng so vá»›i cÃ¹ng ká»³ nÄƒm trÆ°á»›c
   CÃ´ng thá»©c:
   ```sql
   YoY Growth = (current_year - prev_year) * 100.0 / prev_year
   
   prev_year = LAG(revenue, 12) OVER (ORDER BY year_month)
   ```
   ÄÆ¡n vá»‹: %
   Target: > 0%
   Use: Seasonal comparison

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ”® FORECASTING KPIs

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 7.1: Forecast Accuracy (sMAPE)
   Äá»‹nh nghÄ©a: Äá»™ chÃ­nh xÃ¡c dá»± bÃ¡o
   CÃ´ng thá»©c:
   ```
   sMAPE = (100% / n) * Î£(
       |actual - forecast| / (|actual| + |forecast|) / 2
   )
   ```
   ÄÆ¡n vá»‹: %
   Target: < 20% (Good)
   Interpretation: Tháº¥p = chÃ­nh xÃ¡c
   Datamart: forecast_monitoring

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

KPI 7.2: Demand Forecast
   Äá»‹nh nghÄ©a: Dá»± bÃ¡o nhu cáº§u 28 ngÃ y
   Horizon: 28 days
   Confidence Intervals:
   â€¢ yhat: Point forecast
   â€¢ yhat_lo: Lower bound (90%)
   â€¢ yhat_hi: Upper bound (90%)
   Model: LightGBM gradient boosting
   Datamart: demand_forecast

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ KPI SUMMARY TABLE

| KPI | Formula | Target | Unit | Datamart |
|-----|---------|--------|------|----------|
| GMV | SUM(price + freight) | Maximize | BRL | dm_sales_monthly_category |
| AOV | GMV / Orders | >150 | BRL | dm_sales_monthly_category |
| Retention | Repeats / Total | >15% | % | dm_customer_lifecycle |
| On-Time | On-time / Delivered | >90% | % | dm_logistics_sla |
| Cancel | Canceled / Total | <2% | % | dm_seller_kpi |
| Review | AVG(score) | >4.0 | Stars | dm_seller_kpi |
| Delivery | AVG(days) | <15 | Days | dm_logistics_sla |
| sMAPE | Forecast error | <20% | % | forecast_monitoring |

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

ğŸ“‹ FILES LIÃŠN QUAN:
   - docs/kpi_definitions.md: Full definitions
   - README.md: Recommended dashboards


================================================================================
ğŸ“Œ 5.6. TIá»‚U Káº¾T CHÆ¯Æ NG
================================================================================

ğŸ“ ÄIá»‚M CHÃNH Cáº¦N TÃ“M Táº®T:

âœ… ORDER-TO-CASH PROCESS:
   â€¢ 6 bÆ°á»›c: Order â†’ Approve â†’ Process â†’ Ship â†’ Pay â†’ Review
   â€¢ 9 báº£ng Olist nguá»“n
   â€¢ 8 tráº¡ng thÃ¡i order lifecycle
   â€¢ SLA: >90% on-time, <15 days avg

âœ… KPI SYSTEM:
   â€¢ 20 KPIs cá»‘t lÃµi
   â€¢ 7 datamarts pre-aggregated
   â€¢ Real-time tracking
   â€¢ Actionable insights

âœ… QUESTION ANSWERING:
   â€¢ 12 cÃ¢u há»i thÆ°á»ng gáº·p
   â€¢ 4 methods: Chat / Query Window / Metabase / SQL
   â€¢ Natural language support
   â€¢ Self-service analytics

âœ… DATA MAPPING:
   â€¢ Bronze â†’ Silver â†’ Gold â†’ Platinum
   â€¢ 36 assets total
   â€¢ Automated ETL 8-10 min
   â€¢ Business-ready datamarts

âœ… KPI STANDARDIZATION:
   â€¢ Formulas documented
   â€¢ Targets defined
   â€¢ Datamarts linked
   â€¢ Dashboard templates

ğŸ¯ THÃ€NH QUáº¢:
   E-commerce analytics platform vá»›i:
   â€¢ Complete Order-to-Cash visibility
   â€¢ 20 standardized KPIs
   â€¢ Self-service question answering
   â€¢ 134K+ pre-aggregated rows

ğŸ“Š GIÃ TRá»Š:
   Business users cÃ³ thá»ƒ:
   â€¢ Track revenue trends
   â€¢ Monitor operational KPIs
   â€¢ Analyze customer behavior
   â€¢ Optimize logistics
   â€¢ Forecast demand

================================================================================
ğŸ“ DANH SÃCH FILE Cáº¦N Äá»ŒC Äá»‚ VIáº¾T BÃO CÃO
================================================================================

MUST READ:
   1. docs/kpi_definitions.md (full)
   2. load_dataset_into_mysql/01_olist.sql: Schema
   3. etl_pipeline/etl_pipeline/assets/gold.py: Process
   4. etl_pipeline/etl_pipeline/assets/platinum.py: Datamarts
   5. metabase_queries.sql: Sample queries
   6. PROJECT_OVERVIEW.md: Use cases

NICE TO HAVE:
   7. chat_service/: NL to SQL
   8. app/pages/1_ğŸ“Š_Query_Window.py: OLAP
   9. docs/data_dictionary.md: Schema details

================================================================================
EOF


